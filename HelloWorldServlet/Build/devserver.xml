<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project basedir="." default="all" name="DevServer">

	<import file="./platform.xml" />

	<property name="dest" value="./devserver" />

	<target name="prepare">
		<mkdir dir="${dest}" />
	</target>

	<target name="cleanup">
		<delete dir="${dest}" />
	</target>

	<target name="package">
		<!-- copy the libs -->
		<mkdir dir="${dest}/Libs" />
		<copy todir="${dest}/Libs/">
			<fileset dir="../Libs">
				<include name="**/*.jar" />
			</fileset>
			<!--<fileset dir="../Libs/gen">
						<include name="**/*.jar" />
					</fileset>-->
		</copy>

		<!-- copy the configuration (etc) -->
		<mkdir dir="${dest}/conf" />
		<copy todir="${dest}/conf/util">
			<fileset dir="../Util/etc/" />
		</copy>
		<copy todir="${dest}/conf/appserver">
			<fileset dir="../AppServer/etc/" />
		</copy>

		<!-- copy the classpath -->
		<copyfile src="../AppServer/classpath.txt" dest="${dest}/appserver_classpath.txt" />

		<!-- copy the tools python script -->
		<copy todir="${dest}">
			<fileset dir="../Tools/src">
				<include name="**/*.*" />
			</fileset>
		</copy>

		<!-- Swap the configuration files -->
		<delete file="${dest}/etc/appServer.properties" />
		<rename dest="${dest}/etc/appServer.properties" src="${tmpdir}/etc/appServer.properties_dev" />

		<delete file="${dest}/etc/jdoDefault.properties" />
		<rename dest="${dest}/etc/jdoDefault.properties" src="${tmpdir}/etc/jdoDefault.properties_dev" />

		<!-- create a zip archive of the dest folder -->
		<delete file="devserver.zip" />
		<zip destfile="devserver.zip">
			<fileset dir="${dest}" />
		</zip>
	</target>

	<target name="all" depends="mkcp,prepare,build,package,cleanup" />

</project>
